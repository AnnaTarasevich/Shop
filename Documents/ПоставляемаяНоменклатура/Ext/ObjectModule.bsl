&НаСервере
Процедура ОбработкаПроведения(Отказ, Режим)
    Движения.ДвиженияТоваров.Записывать = Истина;
    ДатаДокумента = ЭтотОбъект.Дата; // Используем дату документа

    Для Каждого ТекСтрокаПоставка Из Поставка Цикл
        
        // Создаем движение товара
        Движение = Движения.ДвиженияТоваров.Добавить();
        Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
        Движение.Период = ДатаДокумента; // Указываем период
        Движение.Номенклатура = ТекСтрокаПоставка.Номенклатура;
        Движение.Количество = ТекСтрокаПоставка.Количество;

        // Поиск записи по Номенклатуре и Периоду
        НаборЗаписей = РегистрыСведений.ЦеныНаНоменклатуру.СоздатьНаборЗаписей();
        НаборЗаписей.Отбор.Номенклатура.Установить(ТекСтрокаПоставка.Номенклатура);
        НаборЗаписей.Отбор.Период.Установить(ДатаДокумента);
        НаборЗаписей.Прочитать();

        Если НаборЗаписей.Количество() > 0 Тогда
            // Обновляем существующую запись
            Запись = НаборЗаписей[0];
            Запись.ЗакупочнаяЦена = ТекСтрокаПоставка.Цена;
        Иначе
            // Создаем новую запись
            Запись = НаборЗаписей.Добавить();
            Запись.Период = ДатаДокумента;
            Запись.Номенклатура = ТекСтрокаПоставка.Номенклатура;
            Запись.ЗакупочнаяЦена = ТекСтрокаПоставка.Цена;
        КонецЕсли;

        // Записываем изменения
        НаборЗаписей.Записать();
    КонецЦикла;
КонецПроцедуры